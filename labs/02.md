# Лабораторная работа №2

* Выдана: 9 марта 2017
* Срок сдачи: 20 марта 2017

## Подготовка к работе
Используйте ту же базу, что и в [лабораторной №1](./labs/01.md)

## Соединение таблиц
1. Найдите все места (`seats`) в самолётах (`aircrafts`), у которых дальность полета (`range`) меньше 3000. Выведите модель самолёта, номер места и класс обслуживания.
1. Выведите таблицу `flights`, заменив в ней колонки с кодами аэропортов на названия аэропортов. Упорядочите результат по `flight_id` в обратном порядке, выводите не более 10 кортежей.
1. Выведите все модели (`model`) самолётов, которые отправляются из аэропорта города Владивосток. Запрос не должен содержать в себе найденного заранее кода аэропорта.
1. Найдите посадочные талоны для рейсов, отправляющихся (со статусом `'On Time'` или `'Delayed'`) из Домодедово (DME) в ближайший час. Используйте функцию `bookings.now()`. Выведите номер рейса (`flight_no`), время отправления (`scheduled_departure`), номер билета (`ticket_no`) и номер посадочного талона (`boarding_no`). Упорядочите результат по времени отправления.
1. Измените запрос из предыдущего задания так, чтобы вывести только посадочные талоны на места из бизнес-класса. Hint: используйте информацию из таблицы `seats`.
1. Найдите все пары рейсов LDE -> VKO, VKO -> VVO такие, чтобы время пересадки было не больше 12 часов, а самолет из Пулково отправлялся в ближайшую неделю. Выведите время отправления из Пулково, время прибытия во Внуково, время отправления из Внуково, время прибытия во Владивосток, время пересадки (между прибытием и отправлением из Внуково), общее время в пути из Пулково во Владивосток. Упорядочите записи сначала по общему времени в пути, затем по дате отправления из Пулково.
1. Выведите имена и стоимость билетов пассажиров с 10 самыми дорогими билетами.
1. Найдите все посадочные талоны выданные по билетам на имя `YULIYA MOROZOVA`, купленным за последние 7 дней. Выведите следующие атрибуты: номер бронирования (`book_ref`), дата бронирования (`book_date`), номер билета (`ticket_no`), ID рейса (`flight_id`), номер посадочного талона (`boarding_no`), номер места (`seat_no`), класс обслуживания (`fare_conditions`). Если по билету еще не выдан посадочный талон, то в соответствующих атрибутах должны стоять значения NULL. Упорядочите результат сначала по `book_ref`, затем по `book_date`. Выводите не более 50 кортежей.
1. И как всегда бонус: придумайте интересный запрос на эту тему.

## Литература
* https://www.postgresql.org/docs/current/static/tutorial-join.html - Соединение таблиц
* https://www.w3schools.com/sql/sql_join.asp - Соединение таблиц для самых маленьких
* https://www.pgexercises.com/questions/joins/ - Упражнения
* https://www.postgresql.org/docs/current/static/queries-table-expressions.html (7.2.1.1, 7.2.2) - Более подробно
* https://www.postgresql.org/docs/current/static/functions-subquery.html - Подзапросы
* https://www.postgresql.org/docs/current/static/queries-with.html#QUERIES-WITH-SELECT (До рекурсивных) - Псевдонимы для подзапросов
* http://stackoverflow.com/questions/2577174/join-vs-sub-query - Об отличиях подзапросов и соединения таблиц
